<% provide(:title, 'Blog') %>

<div id="blog-index-filter-container" class="container">
  <h3>Filter</h3>
  <div class="dropdown">
    <button class="btn btn-default dropdown-toggle" type="button" id="menu1"
      data-toggle="dropdown">Options <span class="caret"></span></button>
    <ul class="dropdown-menu">
      <li class="dropdown-header">Topics</li>
      <% @topics.each do |topic| %>
        <li id="topic-<%= topic %>">
          <%= link_to topic, blogs_path(topic: topic) %>
        </li>
      <% end %>
      <li class="divider"></li>
      <li class="dropdown-header">Authors</li>
      <% @authors.each do |author| %>
        <li id="author-<%= author %>">
          <%# TODO fix non-unique name bug, but it is also bugged in blog_helper %>
          <%= link_to author, blogs_path(author: User.find_by(name: author)) %>
        </li>
      <% end %>
    </ul>
  </div>
</div>

<div class="container">
  <h1 id="index-header">Index</h1>
  <%# TODO filter output %>
  <div class="container">
    <ul id="blog-index">
      <div id="blog-index-top-page-select"> <%= will_paginate %> </div>
      <% @blogs.each do |blog| %>
        <li class="ii" id="topic-<%= blog.topic %>-author-<%= author_name(blog.user_id) %>">
          <%= link_to blog.title, blog_path(blog.id), class: "ii-title" %>
          <p><em><%= blog.descript %></em></p>
          <%# TODO fix database hits %>
          <p><em>Author: <%= author_name(blog.user_id) %> </em></p>
          <% if current_user && blog_owner(blog) %>
            <p>Options | <%= link_to "edit", edit_blog_path(blog.id) %>
          <%= link_to "delete", blog, method: :delete,
            data: { confirm: "You sure?" } %> </p>
        <% end %>
        </li>
      <% end %>
    </ul>
    <%= will_paginate %>
  </div>

</div>
